<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShadowMap Scan Report - {{DOMAIN}}</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #e0e0e0;
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-y: auto;
        }
        .header {
            max-width: 1200px;
            margin: 0 auto 10px auto;
            text-align: center;
            padding: 0 10px;
        }

        @keyframes pulseGlow {
            0% { box-shadow: 0 0 10px rgba(0, 123, 255, 0.4), 0 0 20px rgba(0, 123, 255, 0.3); }
            50% { box-shadow: 0 0 25px rgba(0, 123, 255, 0.8), 0 0 50px rgba(0, 123, 255, 0.6); }
            100% { box-shadow: 0 0 10px rgba(0, 123, 255, 0.4), 0 0 20px rgba(0, 123, 255, 0.3); }
        }

        .banner-image {
            width: 200%;
            max-width: none;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            display: block;
            position: relative;
            left: 50%;
            transform: translateX(-50%);
            animation: pulseGlow 2.5s infinite ease-in-out;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 15px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 180px - 50px);
            box-sizing: border-box;
            backdrop-filter: blur(10px);
        }

        h1, h2 { color: #00d4ff; margin-top: 0; margin-bottom: 10px; text-shadow: 0 0 20px rgba(0, 212, 255, 0.5); }
        h3 { color: #5bc0de; margin-top: 15px; margin-bottom: 8px; }

        .main-tabs { display: flex; flex-wrap: wrap; margin-bottom: 10px; border-bottom: 2px solid #333; }
        .main-tab-button {
            padding: 12px 20px;
            cursor: pointer;
            background: linear-gradient(135deg, #2a2a3a 0%, #1e1e2e 100%);
            border: 1px solid #444;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            margin-right: 8px;
            color: #e0e0e0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1em;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }
        .main-tab-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        .main-tab-button:hover::before {
            left: 100%;
        }
        .main-tab-button:hover { 
            background: linear-gradient(135deg, #3a3a4a 0%, #2e2e3e 100%); 
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }
        .main-tab-button.active { 
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); 
            color: white; 
            border-color: #007bff;
            box-shadow: 0 4px 20px rgba(0, 123, 255, 0.4);
        }

        .sub-tabs { display: flex; flex-wrap: wrap; margin-top: 10px; margin-bottom: 10px; border-bottom: 1px solid #444; }
        .sub-tab-button {
            padding: 8px 16px;
            cursor: pointer;
            background: linear-gradient(135deg, #444 0%, #333 100%);
            border: 1px solid #555;
            border-bottom: none;
            border-radius: 6px 6px 0 0;
            margin-right: 5px;
            color: #ccc;
            transition: all 0.3s ease;
            font-size: 0.85em;
        }
        .sub-tab-button:hover { 
            background: linear-gradient(135deg, #666 0%, #555 100%); 
            transform: translateY(-1px);
        }
        .sub-tab-button.active { 
            background: linear-gradient(135deg, #5bc0de 0%, #46a7c7 100%); 
            color: white; 
            border-color: #5bc0de;
            box-shadow: 0 2px 10px rgba(91, 192, 222, 0.4);
        }

        .tab-content { display: none; padding: 15px 0; border-top: 2px solid #007bff; flex-grow: 1; overflow-y: auto; }
        .tab-content.active { display: block; }
        .sub-tab-content { display: none; padding: 10px 0; border-top: 1px solid #5bc0de; flex-grow: 1; overflow-y: auto; }
        .sub-tab-content.active { display: block; }

        .results-grid { display: grid; grid-template-columns: 1fr; gap: 16px; padding: 10px; margin: 0 auto; max-width: 90%; }
        .result-card {
            background: linear-gradient(135deg, rgba(42, 42, 58, 0.9) 0%, rgba(30, 30, 46, 0.9) 100%);
            border: 1px solid rgba(68, 68, 68, 0.5); border-radius: 12px; padding: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden;
            backdrop-filter: blur(5px); cursor: pointer; min-height: 16px;
            display: flex; align-items: center;
        }
        .result-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent, var(--priority-color, #666), transparent);
            transform: translateX(-100%); transition: transform 0.6s ease;
        }
        .result-card:hover::before { transform: translateX(100%); }
        .result-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6), 0 0 30px var(--priority-glow, rgba(102, 102, 102, 0.3));
            border-color: var(--priority-color, #666);
        }
        .result-card.red-priority { --priority-color: #ff4d4d; --priority-glow: rgba(255, 77, 77, 0.4); }
        .result-card.yellow-priority { --priority-color: #FFD700; --priority-glow: rgba(255, 215, 0, 0.4); }
        .result-card.green-priority { --priority-color: #90EE90; --priority-glow: rgba(144, 238, 144, 0.4); }
        .result-card.cyan-priority { --priority-color: #00FFFF; --priority-glow: rgba(0, 255, 255, 0.4); }
        .result-card.orange-priority { --priority-color: #FFA500; --priority-glow: rgba(255, 165, 0, 0.4); }
        .result-card.gray-priority { --priority-color: #888; --priority-glow: rgba(136, 136, 136, 0.3); }

        .result-header { display: flex; align-items: center; width: 100%; }
        .result-icon { font-size: 1.5em; margin-right: 12px; filter: drop-shadow(0 0 8px currentColor); }
        .result-url {
            color: #e0e0e0; font-weight: 500; font-size: 0.95em; word-break: break-all;
            flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .result-url a { color: inherit; text-decoration: none; }
        .result-url a:hover { text-decoration: underline; }

        .result-meta-info { display: flex; align-items: center; gap: 12px; margin-left: auto; }
        .status-code {
            background-color: var(--priority-color, #666); color: #1a1a2e; padding: 4px 12px;
            border-radius: 20px; font-size: 0.85em; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .last-modified-date {
            background-color: #555; color: #e0e0e0; padding: 4px 10px; border-radius: 20px;
            font-size: 0.75em; font-weight: normal; display: flex; align-items: center; gap: 5px;
        }
        .last-modified-date.old-asset {
            background-color: #d9534f;
            color: white;
            font-weight: bold;
        }

        pre.output {
            background: linear-gradient(135deg, #111 0%, #1a1a1a 100%); color: #e0e0e0; padding: 15px;
            border-radius: 8px; overflow-x: auto; white-space: pre-wrap; word-break: break-all;
            font-family: 'Courier New', Courier, monospace; border: 1px solid #333;
            max-height: calc(100vh - 350px); box-sizing: border-box; box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
        }
        .summary-item, .osint-item { 
            margin-bottom: 8px; font-size: 0.95em; background: rgba(0, 123, 255, 0.1);
            padding: 8px 12px; border-radius: 6px; border-left: 3px solid #007bff;
        }
        .summary-item strong, .osint-item strong { color: #00d4ff; }
        .footer { text-align: center; margin-top: 20px; padding-top: 10px; border-top: 1px solid #333; color: #888; font-size: 0.8em; }
        .footer-logo { height: 25px; vertical-align: middle; margin-left: 5px; }
        .filter-section {
            margin-bottom: 15px; display: flex; align-items: center; gap: 15px;
            background: rgba(0, 123, 255, 0.1); padding: 12px; border-radius: 8px;
            border: 1px solid rgba(0, 123, 255, 0.3); margin: 0 auto 15px auto; max-width: 90%;
        }
        .filter-section label { font-size: 0.95em; color: #e0e0e0; cursor: pointer; user-select: none; }
        .filter-section input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; accent-color: #00d4ff; }
        @keyframes iconPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .result-card:hover .result-icon { animation: iconPulse 0.6s ease-in-out; }
        .copy-notification {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: #00d4ff;
            color: #1a1a2e; padding: 10px 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
            z-index: 1000; opacity: 0; transition: opacity 0.3s ease, transform 0.3s ease; pointer-events: none;
        }
        .copy-notification.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }
        .port-scan-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 16px; padding: 10px; margin: 0 auto; max-width: 90%; }
        .port-card {
            background: linear-gradient(135deg, #2a2a3a, #1e1e2e); border: 1px solid #444; border-radius: 8px;
            padding: 15px; transition: all 0.3s ease;
        }
        .port-card h4 { margin-top: 0; color: #00d4ff; }
        .port-list { list-style: none; padding-left: 0; }
        .port-list-item { background: #333; margin-bottom: 5px; padding: 8px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        .port-number { color: #e0e0e0; font-weight: bold; }
        .port-status { font-size: 0.9em; padding: 3px 8px; border-radius: 10px; }
        .port-status.open { background-color: #28a745; color: white; }
        .port-status.filtered { background-color: #ffc107; color: black; }
        .port-status.closed { background-color: #dc3545; color: white; }

        @media (max-width: 768px) {
            body { padding: 5px; } .container { padding: 10px; border-radius: 8px; }
            .main-tab-button, .sub-tab-button { flex: 1 1 auto; margin-right: 0; margin-bottom: 5px; border-radius: 5px; }
            .main-tabs, .sub-tabs { flex-direction: column; }
            .results-grid, .port-scan-grid { grid-template-columns: 1fr; padding: 5px; max-width: 95%; }
            .filter-section { padding: 8px; max-width: 95%; }
            .result-card { padding: 12px; height: auto; }
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://raw.githubusercontent.com/Xzar-x/images/refs/heads/main/shadowmap.png" alt="ShadowMap Banner" class="banner-image">
    </div>

    <div class="container">
        <h1>ShadowMap Scan Report for {{DOMAIN}}</h1>
        <div class="main-tabs">
            <div class="main-tab-button active" onclick="openMainTab(event, 'summary')">Podsumowanie</div>
            <div class="main-tab-button" onclick="openMainTab(event, 'phase0')">Faza 0: OSINT</div>
            <div class="main-tab-button" onclick="openMainTab(event, 'phase1')">Faza 1: Subdomeny</div>
            <div class="main-tab-button" onclick="openMainTab(event, 'phase2')">Faza 2: Porty</div>
            <div class="main-tab-button" onclick="openMainTab(event, 'phase3')">Faza 3: Katalogi</div>
            <div class="main-tab-button" onclick="openMainTab(event, 'phase4')">Faza 4: Web Crawling</div>
            <div class="main-tab-button" onclick="openMainTab(event, 'all_results')">Wszystkie wyniki</div>
        </div>

        <div id="summary" class="tab-content active">
            <h2>Podsumowanie skanowania</h2>
            <div class="summary-item"><strong>Domena:</strong> {{DOMAIN}}</div>
            <div class="summary-item"><strong>Ca≈Çkowita liczba znalezionych subdomen (Faza 1):</strong> {{COUNT_ALL_SUBDOMAINS}}</div>
            <div class="summary-item"><strong>Liczba aktywnych subdomen HTTP/S (Faza 1):</strong> {{COUNT_HTTPX}}</div>
            <div class="summary-item"><strong>Liczba otwartych port√≥w (Faza 2):</strong> {{COUNT_OPEN_PORTS}}</div>
            <div class="summary-item"><strong>Liczba znalezionych katalog√≥w/plik√≥w (Faza 3):</strong> {{COUNT_DIR_SEARCH}}</div>
            <div class="summary-item"><strong>Liczba unikalnych URL-i z crawlera (Faza 4):</strong> {{COUNT_ALL_URLS_P4}}</div>
        </div>

        <div id="phase0" class="tab-content">
            <h2>Faza 0: Zwiad Pasywny (OSINT)</h2>
            <div class="osint-item"><strong>Adres IP:</strong> {{OSINT_IP}}</div>
            <div class="osint-item"><strong>ASN / Dostawca:</strong> {{OSINT_ASN_DETAILS}}</div>
            <div class="osint-item"><strong>CDN:</strong> {{OSINT_CDN}}</div>
            <div class="osint-item"><strong>Rejestrator Domeny:</strong> {{OSINT_REGISTRAR}}</div>
            <div class="osint-item"><strong>Data Utworzenia:</strong> {{OSINT_CREATION_DATE}}</div>
            <div class="osint-item"><strong>Data Wyga≈õniƒôcia:</strong> {{OSINT_EXPIRATION_DATE}}</div>
            <div class="osint-item"><strong>Serwery Nazw (NS):</strong> <pre class="output" style="margin-top: 5px;">{{OSINT_NAME_SERVERS}}</pre></div>
            <div class="osint-item"><strong>Technologie (strona g≈Ç√≥wna):</strong> <pre class="output" style="margin-top: 5px;">{{OSINT_TECHNOLOGIES}}</pre></div>
        </div>

        <div id="phase1" class="tab-content">
            <h2>Faza 1: Enumeracja Subdomen</h2>
            <div class="sub-tabs">
                <div class="sub-tab-button active" onclick="openSubTab(event, 'phase1', 'httpx')">HTTPX</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase1', 'subfinder')">Subfinder</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase1', 'assetfinder')">Assetfinder</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase1', 'findomain')">Findomain</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase1', 'puredns')">Puredns</div>
            </div>

            <div id="phase1-httpx" class="sub-tab-content active">
                <h3>HTTPX Output ({{COUNT_HTTPX}} aktywnych)</h3>
                <div class="filter-section">
                    <input type="checkbox" id="showOnlyCriticalP1" onchange="renderResults(httpxDataP1, 'httpx-results', this.checked)">
                    <label for="showOnlyCriticalP1">Poka≈º tylko krytyczne üî•</label>
                </div>
                <div id="httpx-results" class="results-grid"></div>
            </div>
            <div id="phase1-subfinder" class="sub-tab-content"><h3>Subfinder Output</h3><pre class="output">{{SUBFINDER_OUTPUT}}</pre></div>
            <div id="phase1-assetfinder" class="sub-tab-content"><h3>Assetfinder Output</h3><pre class="output">{{ASSETFINDER_OUTPUT}}</pre></div>
            <div id="phase1-findomain" class="sub-tab-content"><h3>Findomain Output</h3><pre class="output">{{FINDOMAIN_OUTPUT}}</pre></div>
            <div id="phase1-puredns" class="sub-tab-content"><h3>Puredns Output</h3><pre class="output">{{PUREDNS_OUTPUT}}</pre></div>
        </div>

        <div id="phase2" class="tab-content">
            <h2>Faza 2: Skanowanie Port√≥w</h2>
            <div class="sub-tabs">
                <div class="sub-tab-button active" onclick="openSubTab(event, 'phase2', 'summary_ports')">Podsumowanie Port√≥w</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase2', 'nmap_raw')">Nmap (Surowe)</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase2', 'naabu_raw')">Naabu (Surowe)</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase2', 'masscan_raw')">Masscan (Surowe)</div>
            </div>
            <div id="phase2-summary_ports" class="sub-tab-content active">
                <h3>Wizualne podsumowanie otwartych port√≥w (Wyniki Nmap)</h3>
                <div id="port-scan-results" class="port-scan-grid"></div>
            </div>
            <div id="phase2-nmap_raw" class="sub-tab-content">
                <h3>Surowe wyniki Nmap</h3>
                <div id="nmap-raw-output"></div>
            </div>
            <div id="phase2-naabu_raw" class="sub-tab-content"><h3>Surowe wyniki Naabu</h3><pre class="output" id="naabu-raw-output">Brak danych</pre></div>
            <div id="phase2-masscan_raw" class="sub-tab-content"><h3>Surowe wyniki Masscan</h3><pre class="output" id="masscan-raw-output">Brak danych</pre></div>
        </div>
        
        <div id="phase3" class="tab-content">
            <h2>Faza 3: Wyszukiwanie Katalog√≥w</h2>
             <div class="sub-tabs">
                <div class="sub-tab-button active" onclick="openSubTab(event, 'phase3', 'verified_httpx')">‚úÖ Zweryfikowane (HTTPX)</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase3', 'all_dirsearch')">Wszystkie wyniki (surowe)</div>
             </div>
             <div id="phase3-verified_httpx" class="sub-tab-content active">
                <h3>Wyniki z Fazy 3 zweryfikowane przez HTTPX</h3>
                <div class="filter-section">
                    <input type="checkbox" id="showOnlyCriticalP3" onchange="renderResults(httpxDataP3, 'verified-httpx-results', this.checked)">
                    <label for="showOnlyCriticalP3">Poka≈º tylko krytyczne üî•</label>
                </div>
                <div id="verified-httpx-results" class="results-grid"></div>
            </div>
            <div id="phase3-all_dirsearch" class="sub-tab-content">
                <h3>Wszystkie znalezione katalogi i pliki ({{COUNT_DIR_SEARCH}} znalezionych)</h3>
                <pre class="output">{{DIR_SEARCH_ALL_OUTPUT}}</pre>
            </div>
        </div>

        <div id="phase4" class="tab-content">
            <h2>Faza 4: Web Crawling i Link Discovery</h2>
            <div class="sub-tabs">
                <div class="sub-tab-button active" onclick="openSubTab(event, 'phase4', 'all_crawled')">Wszystkie URL-e</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase4', 'parameters')">Parametry</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase4', 'js_files')">Pliki JS</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase4', 'api_endpoints')">Endpointy API</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase4', 'interesting_paths')">InteresujƒÖce ≈õcie≈ºki</div>
            </div>

            <div id="phase4-all_crawled" class="sub-tab-content active"><h3>Wszystkie znalezione URL-e ({{COUNT_ALL_URLS_P4}})</h3><pre class="output">{{PHASE4_ALL_URLS_OUTPUT}}</pre></div>
            <div id="phase4-parameters" class="sub-tab-content"><h3>Znalezione parametry ({{COUNT_PARAMETERS}})</h3><pre class="output">{{PARAMETERS_OUTPUT}}</pre></div>
            <div id="phase4-js_files" class="sub-tab-content"><h3>Pliki JavaScript ({{COUNT_JS_FILES}})</h3><pre class="output">{{JS_FILES_OUTPUT}}</pre></div>
            <div id="phase4-api_endpoints" class="sub-tab-content"><h3>Endpointy API ({{COUNT_API_ENDPOINTS}})</h3><pre class="output">{{API_ENDPOINTS_OUTPUT}}</pre></div>
            <div id="phase4-interesting_paths" class="sub-tab-content"><h3>InteresujƒÖce ≈õcie≈ºki ({{COUNT_INTERESTING_PATHS}})</h3><pre class="output">{{INTERESTING_PATHS_OUTPUT}}</pre></div>
        </div>
        
        <div id="all_results" class="tab-content">
            <h2>Wszystkie znalezione subdomeny i URL-e</h2>
            <h3>Wszystkie subdomeny ({{COUNT_ALL_SUBDOMAINS}})</h3>
            <pre class="output">{{ALL_SUBDOMAINS_OUTPUT}}</pre>
            <h3>Wszystkie URL-e z Fazy 3 i 4 ({{COUNT_ALL_URLS_COMBINED}})</h3>
            <pre class="output">{{ALL_URLS_COMBINED_OUTPUT}}</pre>
        </div>
    </div>

    <div class="footer">
        Made by Xzar
        <img src="https://raw.githubusercontent.com/Xzar-x/images/refs/heads/main/logo.png" alt="Logo" class="footer-logo">
    </div>

    <div id="copy-notification" class="copy-notification"></div>

    <script>
        // --- Globalne dane ---
        const httpxDataP1 = {{HTTPX_OUTPUT_JSON_P1}};
        const httpxDataP3 = {{HTTPX_OUTPUT_JSON_P3}};
        const nmapRawResults = {{NMAP_RESULTS_RAW_JSON}};
        const naabuRawOutput = `{{NAABU_RAW_OUTPUT}}`;
        const masscanRawOutput = `{{MASSCAN_RAW_OUTPUT}}`;

        function copyToClipboard(text) {
            const notification = document.getElementById('copy-notification');
            if (!text || !notification) return;
            navigator.clipboard.writeText(text).then(() => {
                notification.textContent = 'Skopiowano: ' + text;
                notification.style.backgroundColor = '#00d4ff';
                notification.classList.add('show');
                setTimeout(() => notification.classList.remove('show'), 2000);
            }, (err) => {
                console.error('B≈ÇƒÖd podczas kopiowania', err);
                notification.textContent = 'B≈ÇƒÖd kopiowania!';
                notification.style.backgroundColor = '#ff4d4d';
                notification.classList.add('show');
                setTimeout(() => notification.classList.remove('show'), 2000);
            });
        }

        function createResultCard(itemData) {
            const { url, status_code, last_modified, priority, icon } = itemData;
            const card = document.createElement('div');
            card.className = `result-card ${priority}-priority`;
            card.addEventListener('click', () => copyToClipboard(url));
            
            let metaInfo = '';
            let statusCodeHtml = status_code ? `<span class="status-code">[${status_code}]</span>` : '';
            let lastModifiedHtml = '';

            if (last_modified) {
                const date = new Date(last_modified);
                const formattedDate = date.toISOString().split('T')[0];
                const isOld = date.getFullYear() < (new Date().getFullYear() - 3);
                lastModifiedHtml = `
                    <div class="last-modified-date ${isOld ? 'old-asset' : ''}" title="${last_modified}">
                        <span>üìÖ</span>
                        <span>${formattedDate}</span>
                    </div>`;
            }
            if (statusCodeHtml || lastModifiedHtml) {
                metaInfo = `<div class="result-meta-info">${lastModifiedHtml}${statusCodeHtml}</div>`;
            }

            card.innerHTML = `
                <div class="result-header">
                    <div class="result-icon">${icon}</div>
                    <div class="result-url"><a href="${url}" target="_blank" title="${url}" onclick="event.stopPropagation()">${url}</a></div>
                    ${metaInfo}
                </div>
            `;
            return card;
        }
        
        function processAndCategorize(data) {
            const sensitiveKeywords = ['admin', 'login', 'panel', 'dashboard', 'config', 'backup', 'db', '.git', '.env', 'secret', 'token', 'api', 'graphql'];
            const url = data.url;
            const code = data.status_code;
            
            let priority = 'gray', icon = 'üîó', isCritical = false;

            if (code) {
                if ([500, 502, 503, 401, 403].includes(code)) { priority = 'red'; icon = 'üî•'; isCritical = true; }
                else if ([301, 302, 307].includes(code)) { priority = 'orange'; icon = 'üëâ'; }
                else if (code === 200) { priority = 'green'; icon = '‚úÖ'; }
            }
            if (sensitiveKeywords.some(kw => url.toLowerCase().includes(kw))) { 
                priority = 'red'; icon = 'üî•'; isCritical = true; 
            }
            return { ...data, priority, icon, isCritical };
        }

        function renderResults(dataArray, containerId, showOnlyCritical = false) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = '';
            
            let parsedData;
            try {
                parsedData = typeof dataArray === 'string' ? JSON.parse(dataArray) : dataArray;
            } catch(e) {
                container.innerHTML = '<p style="text-align: center;">B≈ÇƒÖd parsowania danych.</p>';
                return;
            }

            if (!Array.isArray(parsedData) || parsedData.length === 0) {
                container.innerHTML = '<p style="text-align: center;">Brak wynik√≥w do wy≈õwietlenia.</p>';
                return;
            }

            let itemsToRender = parsedData.map(processAndCategorize);
            if (showOnlyCritical) {
                itemsToRender = itemsToRender.filter(item => item.isCritical);
            }
            
            if (itemsToRender.length === 0) {
                container.innerHTML = '<p style="text-align: center;">Brak wynik√≥w spe≈ÇniajƒÖcych kryteria.</p>';
                return;
            }

            itemsToRender.forEach(item => {
                const card = createResultCard(item);
                container.appendChild(card);
            });
        }
        
        function renderPortScanResults(nmapData) {
            const container = document.getElementById('port-scan-results');
            if (!container) return;
            container.innerHTML = '';
            
            let parsedNmap;
            try {
                parsedNmap = typeof nmapData === 'string' ? JSON.parse(nmapData) : nmapData;
            } catch (e) {
                container.innerHTML = '<p style="text-align: center;">B≈ÇƒÖd parsowania danych Nmap.</p>';
                return;
            }

            if (Object.keys(parsedNmap).length === 0) {
                container.innerHTML = '<p style="text-align: center;">Brak wynik√≥w skanowania port√≥w.</p>';
                return;
            }

            for (const host in parsedNmap) {
                const card = document.createElement('div');
                card.className = 'port-card';
                let listItems = '';

                (parsedNmap[host] || "").split('\n').forEach(line => {
                    const match = line.match(/^(\d+)\/tcp\s+(open|filtered|closed)\s+(.*)/);
                    if (match) {
                        const port = parseInt(match[1]);
                        const status = match[2];
                        const service = match[3].trim();
                        
                        listItems += `
                            <li class="port-list-item">
                                <div>
                                    <span class="port-number">${port}/tcp</span> - ${service}
                                </div>
                                <span class="port-status ${status}">${status}</span>
                            </li>`;
                    }
                });

                if (listItems) {
                    card.innerHTML = `<h4>${host}</h4><ul class="port-list">${listItems}</ul>`;
                    container.appendChild(card);
                }
            }
        }

        function renderRawText(data, elementId) {
            const element = document.getElementById(elementId);
            if (element && data && data.trim() !== 'Brak danych') {
                element.textContent = data;
            }
        }
        
        function renderNmapRawResults(nmapData) {
            const container = document.getElementById('nmap-raw-output');
            if (!container) return;
            container.innerHTML = '';
             let parsedNmap;
            try {
                parsedNmap = typeof nmapData === 'string' ? JSON.parse(nmapData) : nmapData;
            } catch (e) {
                container.innerHTML = '<pre class="output">B≈ÇƒÖd parsowania danych Nmap.</pre>';
                return;
            }
            if (Object.keys(parsedNmap).length === 0) {
                container.innerHTML = '<pre class="output">Brak surowych wynik√≥w Nmap.</pre>';
                return;
            }

            for (const host in parsedNmap) {
                const pre = document.createElement('pre');
                pre.className = 'output';
                pre.textContent = `--- ${host} ---\n\n` + parsedNmap[host];
                container.appendChild(pre);
            }
        }

        function openMainTab(evt, tabName) {
            Array.from(document.getElementsByClassName("tab-content")).forEach(t => t.style.display = "none");
            Array.from(document.getElementsByClassName("main-tab-button")).forEach(b => b.classList.remove("active"));
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.classList.add("active");
        }

        function openSubTab(evt, mainTabName, subTabName) {
            const mainTab = document.getElementById(mainTabName);
            Array.from(mainTab.getElementsByClassName("sub-tab-content")).forEach(t => t.style.display = "none");
            Array.from(mainTab.getElementsByClassName("sub-tab-button")).forEach(b => b.classList.remove("active"));
            document.getElementById(`${mainTabName}-${subTabName}`).style.display = "block";
            evt.currentTarget.classList.add("active");
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderResults(httpxDataP1, 'httpx-results', false);
            renderResults(httpxDataP3, 'verified-httpx-results', false);
            renderPortScanResults(nmapRawResults);
            renderNmapRawResults(nmapRawResults);
            renderRawText(naabuRawOutput, 'naabu-raw-output');
            renderRawText(masscanRawOutput, 'masscan-raw-output');
            
            document.querySelector('.main-tab-button').click();
            const firstActiveSubTab = document.querySelector('.tab-content.active .sub-tab-button');
             if(firstActiveSubTab) {
                firstActiveSubTab.click();
            }
        });
    </script>
</body>
</html>
