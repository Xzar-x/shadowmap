<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShadowMap Scan Report - {{DOMAIN}}</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #e0e0e0;
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-y: auto;
        }
        .header {
            max-width: 1200px;
            margin: 0 auto 10px auto;
            text-align: center;
            padding: 0 10px;
        }

        @keyframes pulseGlow {
            0% { box-shadow: 0 0 10px rgba(0, 123, 255, 0.4), 0 0 20px rgba(0, 123, 255, 0.3); }
            50% { box-shadow: 0 0 25px rgba(0, 123, 255, 0.8), 0 0 50px rgba(0, 123, 255, 0.6); }
            100% { box-shadow: 0 0 10px rgba(0, 123, 255, 0.4), 0 0 20px rgba(0, 123, 255, 0.3); }
        }

        .banner-image {
            width: 200%;
            max-width: none;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            display: block;
            position: relative;
            left: 50%;
            transform: translateX(-50%);
            animation: pulseGlow 2.5s infinite ease-in-out;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 15px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 180px - 50px);
            box-sizing: border-box;
            backdrop-filter: blur(10px);
        }

        h1, h2 { color: #00d4ff; margin-top: 0; margin-bottom: 10px; text-shadow: 0 0 20px rgba(0, 212, 255, 0.5); }
        h3 { color: #5bc0de; margin-top: 15px; margin-bottom: 8px; }

        .main-tabs { display: flex; flex-wrap: wrap; margin-bottom: 10px; border-bottom: 2px solid #333; }
        .main-tab-button {
            padding: 12px 20px;
            cursor: pointer;
            background: linear-gradient(135deg, #2a2a3a 0%, #1e1e2e 100%);
            border: 1px solid #444;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            margin-right: 8px;
            color: #e0e0e0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1em;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }
        .main-tab-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        .main-tab-button:hover::before {
            left: 100%;
        }
        .main-tab-button:hover { 
            background: linear-gradient(135deg, #3a3a4a 0%, #2e2e3e 100%); 
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }
        .main-tab-button.active { 
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); 
            color: white; 
            border-color: #007bff;
            box-shadow: 0 4px 20px rgba(0, 123, 255, 0.4);
        }

        .sub-tabs { display: flex; flex-wrap: wrap; margin-top: 10px; margin-bottom: 10px; border-bottom: 1px solid #444; }
        .sub-tab-button {
            padding: 8px 16px;
            cursor: pointer;
            background: linear-gradient(135deg, #444 0%, #333 100%);
            border: 1px solid #555;
            border-bottom: none;
            border-radius: 6px 6px 0 0;
            margin-right: 5px;
            color: #ccc;
            transition: all 0.3s ease;
            font-size: 0.85em;
        }
        .sub-tab-button:hover { 
            background: linear-gradient(135deg, #666 0%, #555 100%); 
            transform: translateY(-1px);
        }
        .sub-tab-button.active { 
            background: linear-gradient(135deg, #5bc0de 0%, #46a7c7 100%); 
            color: white; 
            border-color: #5bc0de;
            box-shadow: 0 2px 10px rgba(91, 192, 222, 0.4);
        }

        .tab-content {
            display: none;
            padding: 15px 0;
            border-top: 2px solid #007bff;
            flex-grow: 1;
            overflow-y: auto;
        }
        .tab-content.active { display: block; }

        .sub-tab-content {
            display: none;
            padding: 10px 0;
            border-top: 1px solid #5bc0de;
            flex-grow: 1;
            overflow-y: auto;
        }
        .sub-tab-content.active { display: block; }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr; 
            gap: 16px;
            padding: 10px;
            margin: 0 auto;
            max-width: 90%;
        }

        .result-card {
            background: linear-gradient(135deg, rgba(42, 42, 58, 0.9) 0%, rgba(30, 30, 46, 0.9) 100%);
            border: 1px solid rgba(68, 68, 68, 0.5);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
            cursor: pointer;
            min-height: 16px;
            display: flex;
            align-items: center;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--priority-color, #666), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .result-card:hover::before {
            transform: translateX(100%);
        }

        .result-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6), 0 0 30px var(--priority-glow, rgba(102, 102, 102, 0.3));
            border-color: var(--priority-color, #666);
        }

        .result-card.red-priority {
            --priority-color: #ff4d4d;
            --priority-glow: rgba(255, 77, 77, 0.4);
        }
        .result-card.yellow-priority {
            --priority-color: #FFD700;
            --priority-glow: rgba(255, 215, 0, 0.4);
        }
        .result-card.green-priority {
            --priority-color: #90EE90;
            --priority-glow: rgba(144, 238, 144, 0.4);
        }
        .result-card.cyan-priority {
            --priority-color: #00FFFF;
            --priority-glow: rgba(0, 255, 255, 0.4);
        }
        .result-card.orange-priority {
            --priority-color: #FFA500;
            --priority-glow: rgba(255, 165, 0, 0.4);
        }
        .result-card.gray-priority {
            --priority-color: #888;
            --priority-glow: rgba(136, 136, 136, 0.3);
        }

        .result-header {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .result-icon {
            font-size: 1.5em;
            margin-right: 12px;
            filter: drop-shadow(0 0 8px currentColor);
        }

        .result-url {
            color: #e0e0e0;
            font-weight: 500;
            font-size: 0.95em;
            word-break: break-all;
            flex: 1;
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .result-url a {
            color: inherit;
            text-decoration: none;
        }
        .result-url a:hover {
            text-decoration: underline;
        }

        .result-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }

        .status-code {
            background-color: var(--priority-color, #666);
            color: #1a1a2e;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .result-meta {
            font-size: 0.8em;
            color: #aaa;
            display: none;
        }

        pre.output {
            background: linear-gradient(135deg, #111 0%, #1a1a1a 100%);
            color: #e0e0e0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
            font-family: 'Courier New', Courier, monospace;
            border: 1px solid #333;
            max-height: calc(100vh - 350px);
            box-sizing: border-box;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
        }

        .summary-item { 
            margin-bottom: 8px; 
            font-size: 0.95em; 
            background: rgba(0, 123, 255, 0.1);
            padding: 8px 12px;
            border-radius: 6px;
            border-left: 3px solid #007bff;
        }
        .summary-item strong { color: #00d4ff; }

        .footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #333;
            color: #888;
            font-size: 0.8em;
        }
        .footer-logo {
            height: 25px;
            vertical-align: middle;
            margin-left: 5px;
        }

        .filter-section {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0, 123, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(0, 123, 255, 0.3);
            margin: 0 auto 15px auto;
            max-width: 90%;
        }
        .filter-section label {
            font-size: 0.95em;
            color: #e0e0e0;
            cursor: pointer;
            user-select: none;
        }
        .filter-section input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #00d4ff;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .result-card:hover .result-icon {
            animation: iconPulse 0.6s ease-in-out;
        }

        .copy-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #00d4ff;
            color: #1a1a2e;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
        }
        .copy-notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        @media (max-width: 768px) {
            body { padding: 5px; }
            .container { padding: 10px; border-radius: 8px; }
            .main-tab-button, .sub-tab-button {
                flex: 1 1 auto;
                margin-right: 0;
                margin-bottom: 5px;
                border-radius: 5px;
            }
            .main-tabs, .sub-tabs { flex-direction: column; }
            .results-grid {
                grid-template-columns: 1fr;
                padding: 5px;
                max-width: 95%;
            }
            .filter-section {
                padding: 8px;
                max-width: 95%;
            }
            .result-card {
                padding: 12px;
                height: auto;
            }
            .result-meta {
                display: block;
            }
        }

        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }

        .loading-card {
            background: linear-gradient(90deg, #2a2a3a 0px, #3a3a4a 40px, #2a2a3a 80px);
            background-size: 200px 100%;
            animation: shimmer 1.5s infinite linear;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://raw.githubusercontent.com/Xzar-x/images/refs/heads/main/shadowmap.png" alt="ShadowMap Banner" class="banner-image">
    </div>

    <div class="container">
        <h1>ShadowMap Scan Report for {{DOMAIN}}</h1>

        <div class="main-tabs">
            <div class="main-tab-button active" onclick="openMainTab(event, 'summary')">Podsumowanie</div>
            <div class="main-tab-button" onclick="openMainTab(event, 'phase1')">Faza 1: Subdomeny</div>
            <div class="main-tab-button" onclick="openMainTab(event, 'phase2')">Faza 2: Skanowanie Portów</div>
            <div class="main-tab-button" onclick="openMainTab(event, 'phase3')">Faza 3: Katalogi</div>
            <div class="main-tab-button" onclick="openMainTab(event, 'phase4')">Faza 4: Web Crawling</div>
            <div class="main-tab-button" onclick="openMainTab(event, 'all_results')">Wszystkie wyniki</div>
        </div>

        <div id="summary" class="tab-content active">
            <h2>Podsumowanie skanowania</h2>
            <div class="summary-item"><strong>Domena:</strong> {{DOMAIN}}</div>
            <div class="summary-item"><strong>Całkowita liczba znalezionych subdomen (Faza 1):</strong> {{COUNT_ALL_SUBDOMAINS}}</div>
            <div class="summary-item"><strong>Liczba aktywnych subdomen HTTP/S (Faza 1):</strong> {{COUNT_HTTPX}}</div>
            <div class="summary-item"><strong>Liczba otwartych portów (Faza 2):</strong> {{COUNT_OPEN_PORTS}}</div>
            <div class="summary-item"><strong>Liczba znalezionych katalogów/plików (Faza 3):</strong> {{COUNT_DIR_SEARCH}}</div>
            <div class="summary-item"><strong>Liczba unikalnych URL-i z crawlera (Faza 4):</strong> {{COUNT_ALL_URLS_P4}}</div>
            <div class="summary-item"><strong>Liczba znalezionych parametrów:</strong> {{COUNT_PARAMETERS}}</div>
            <div class="summary-item"><strong>Liczba plików JavaScript:</strong> {{COUNT_JS_FILES}}</div>
            <div class="summary-item"><strong>Liczba endpointów API:</strong> {{COUNT_API_ENDPOINTS}}</div>
            <div class="summary-item"><strong>Liczba interesujących ścieżek:</strong> {{COUNT_INTERESTING_PATHS}}</div>
        </div>

        <div id="phase1" class="tab-content">
            <h2>Faza 1: Enumeracja Subdomen</h2>
            <div class="sub-tabs">
                <div class="sub-tab-button active" onclick="openSubTab(event, 'phase1', 'httpx')">HTTPX</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase1', 'subfinder')">Subfinder</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase1', 'assetfinder')">Assetfinder</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase1', 'findomain')">Findomain</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase1', 'puredns')">Puredns</div>
            </div>

            <div id="phase1-httpx" class="sub-tab-content active">
                <h3>HTTPX Output ({{COUNT_HTTPX}} aktywnych)</h3>
                <div class="filter-section">
                    <input type="checkbox" id="showOnlyRedHttpx" onchange="applyHttpxFilter()">
                    <label for="showOnlyRedHttpx">Pokaż tylko krytyczne 🔥</label>
                </div>
                <div id="httpx-results" class="results-grid"></div>
            </div>
            <div id="phase1-subfinder" class="sub-tab-content">
                <h3>Subfinder Output ({{COUNT_SUBFINDER}} znalezionych)</h3>
                <div id="subfinder-results" class="results-grid"></div>
            </div>
            <div id="phase1-assetfinder" class="sub-tab-content">
                <h3>Assetfinder Output ({{COUNT_ASSETFINDER}} znalezionych)</h3>
                <div id="assetfinder-results" class="results-grid"></div>
            </div>
            <div id="phase1-findomain" class="sub-tab-content">
                <h3>Findomain Output ({{COUNT_FINDOMAIN}} znalezionych)</h3>
                <div id="findomain-results" class="results-grid"></div>
            </div>
            <div id="phase1-puredns" class="sub-tab-content">
                <h3>Puredns Output ({{COUNT_PUREDNS}} znalezionych)</h3>
                <div id="puredns-results" class="results-grid"></div>
            </div>
        </div>

        <div id="phase2" class="tab-content">
            <h2>Faza 2: Skanowanie Portów</h2>
            <div class="sub-tabs">
                <div class="sub-tab-button active" onclick="openSubTab(event, 'phase2', 'naabu')">Naabu (Otwarte Porty)</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase2', 'nmap')">Nmap (Wersje Usług)</div>
            </div>

            <div id="phase2-naabu" class="sub-tab-content active">
                <h3>Naabu Output ({{COUNT_OPEN_PORTS}} otwartych portów)</h3>
                <div id="naabu-results" class="results-grid"></div>
            </div>
            <div id="phase2-nmap" class="sub-tab-content">
                <h3>Nmap Output</h3>
                <div id="nmap-results-panel">
                    {{NMAP_RESULTS_PANEL}}
                </div>
            </div>
        </div>

        <div id="phase3" class="tab-content">
            <h2>Faza 3: Wyszukiwanie Katalogów</h2>
            <div class="sub-tabs">
                <div class="sub-tab-button active" onclick="openSubTab(event, 'phase3', 'verified_httpx')">✅ Zweryfikowane (HTTPX)</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase3', 'all_dirsearch')">Wszystkie wyniki (surowe)</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase3', 'dirsearch')">Dirsearch</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase3', 'ffuf')">Ffuf</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase3', 'feroxbuster')">Feroxbuster</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase3', 'gobuster')">Gobuster</div>
            </div>

            <div id="phase3-verified_httpx" class="sub-tab-content active">
                <h3>Wyniki z Fazy 3 zweryfikowane przez HTTPX</h3>
                <div class="filter-section">
                    <input type="checkbox" id="showOnlyRedVerifiedHttpx" onchange="applyVerifiedHttpxFilter()">
                    <label for="showOnlyRedVerifiedHttpx">Pokaż tylko krytyczne 🔥</label>
                </div>
                <div id="verified-httpx-results" class="results-grid"></div>
            </div>

            <div id="phase3-all_dirsearch" class="sub-tab-content">
                <h3>Wszystkie znalezione katalogi i pliki ({{COUNT_DIR_SEARCH}} znalezionych)</h3>
                <div class="filter-section">
                    <input type="checkbox" id="showOnlyRedDirsearch" onchange="applyDirsearchFilter()">
                    <label for="showOnlyRedDirsearch">Pokaż tylko krytyczne 🔥</label>
                </div>
                <div id="dirsearch-all-results" class="results-grid"></div>
            </div>
            <div id="phase3-dirsearch" class="sub-tab-content">
                <h3>Wyniki z Dirsearch</h3>
                <div id="dirsearch-results-specific" class="results-grid"></div>
            </div>
            <div id="phase3-ffuf" class="sub-tab-content">
                <h3>Wyniki z Ffuf</h3>
                <div id="ffuf-results-specific" class="results-grid"></div>
            </div>
            <div id="phase3-feroxbuster" class="sub-tab-content">
                <h3>Wyniki z Feroxbuster</h3>
                <div id="feroxbuster-results-specific" class="results-grid"></div>
            </div>
            <div id="phase3-gobuster" class="sub-tab-content">
                <h3>Wyniki z Gobuster</h3>
                <div id="gobuster-results-specific" class="results-grid"></div>
            </div>
        </div>

        <div id="phase4" class="tab-content">
            <h2>Faza 4: Web Crawling i Link Discovery</h2>
            <div class="sub-tabs">
                <div class="sub-tab-button active" onclick="openSubTab(event, 'phase4', 'all_crawled')">Wszystkie URL-e</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase4', 'parameters')">Parametry</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase4', 'js_files')">Pliki JS</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase4', 'api_endpoints')">Endpointy API</div>
                <div class="sub-tab-button" onclick="openSubTab(event, 'phase4', 'interesting_paths')">Interesujące ścieżki</div>
            </div>

            <div id="phase4-all_crawled" class="sub-tab-content active">
                <h3>Wszystkie znalezione URL-e ({{COUNT_ALL_URLS_P4}} znalezionych)</h3>
                <div class="filter-section">
                    <input type="checkbox" id="showOnlyRedCrawling" onchange="applyCrawlingFilter()">
                    <label for="showOnlyRedCrawling">Pokaż tylko krytyczne 🔥</label>
                </div>
                <div id="crawling-all-results" class="results-grid"></div>
            </div>
            <div id="phase4-parameters" class="sub-tab-content">
                <h3>Znalezione parametry ({{COUNT_PARAMETERS}} znalezionych)</h3>
                <div id="parameters-results" class="results-grid"></div>
            </div>
            <div id="phase4-js_files" class="sub-tab-content">
                <h3>Pliki JavaScript ({{COUNT_JS_FILES}} znalezionych)</h3>
                <div id="js-files-results" class="results-grid"></div>
            </div>
            <div id="phase4-api_endpoints" class="sub-tab-content">
                <h3>Endpointy API ({{COUNT_API_ENDPOINTS}} znalezionych)</h3>
                <div id="api-endpoints-results" class="results-grid"></div>
            </div>
            <div id="phase4-interesting_paths" class="sub-tab-content">
                <h3>Interesujące ścieżki ({{COUNT_INTERESTING_PATHS}} znalezionych)</h3>
                <div id="interesting-paths-results" class="results-grid"></div>
            </div>
        </div>

        <div id="all_results" class="tab-content">
            <h2>Wszystkie znalezione subdomeny i URL-e</h2>
            <h3>Wszystkie subdomeny ({{COUNT_ALL_SUBDOMAINS}} znalezionych)</h3>
            <div id="all-subdomains-results" class="results-grid"></div>
            <h3>Wszystkie URL-e z Fazy 3 i 4 ({{COUNT_ALL_URLS_COMBINED}} znalezionych)</h3>
            <div id="all-urls-combined-results" class="results-grid"></div>
        </div>

    </div>

    <div class="footer">
        Made by Xzar
        <img src="https://raw.githubusercontent.com/Xzar-x/images/refs/heads/main/logo.png" alt="Logo" class="footer-logo">
    </div>

    <div id="copy-notification" class="copy-notification"></div>

    <script>
        function stripAnsiCodes(str) {
            return str.replace(/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g, '');
        }

        function copyToClipboard(text) {
            const notification = document.getElementById('copy-notification');
            if (!text || !notification) return;

            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed'; 
            textArea.style.top = '0';
            textArea.style.left = '0';
            textArea.style.opacity = '0';

            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                notification.textContent = 'Skopiowano: ' + text;
                notification.style.backgroundColor = '#00d4ff';
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            } catch (err) {
                console.error('Błąd podczas kopiowania do schowka', err);
                notification.textContent = 'Błąd kopiowania!';
                notification.style.backgroundColor = '#ff4d4d';
                notification.classList.add('show');
                 setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }

            document.body.removeChild(textArea);
        }

        // --- Globalne dane ---
        let rawHttpxOutput = stripAnsiCodes(`{{HTTPX_OUTPUT_RAW_FOR_JS}}`);
        let rawNaabuResults = `{{NAABU_RESULTS}}`;
        let rawHttpxPhase3Verified = stripAnsiCodes(`{{HTTPX_PHASE3_VERIFIED_OUTPUT}}`);
        let rawDirSearchAll = stripAnsiCodes(`{{DIR_SEARCH_ALL_OUTPUT}}`).replace(/\\n/g, '\n');;
        let rawDirsearchSpecific = stripAnsiCodes(`{{DIRSEARCH_SPECIFIC_OUTPUT}}`);
        let rawFfufSpecific = stripAnsiCodes(`{{FFUF_SPECIFIC_OUTPUT}}`);
        let rawFeroxbusterSpecific = stripAnsiCodes(`{{FEROXBUSTER_SPECIFIC_OUTPUT}}`);
        let rawGobusterSpecific = stripAnsiCodes(`{{GOBUSTER_SPECIFIC_OUTPUT}}`);
        
        let rawSubfinderOutput = `{{SUBFINDER_OUTPUT}}`;
        let rawAssetfinderOutput = `{{ASSETFINDER_OUTPUT}}`;
        let rawFindomain = `{{FINDOMAIN_OUTPUT}}`;
        let rawPuredns = `{{PUREDNS_OUTPUT}}`;
        let rawAllSubdomains = `{{ALL_SUBDOMAINS_OUTPUT}}`;
        
        let rawPhase4AllUrls = `{{PHASE4_ALL_URLS_OUTPUT}}`;
        let rawParameters = `{{PARAMETERS_OUTPUT}}`;
        let rawJSFiles = `{{JS_FILES_OUTPUT}}`;
        let rawAPIEndpoints = `{{API_ENDPOINTS_OUTPUT}}`;
        let rawInterestingPaths = `{{INTERESTING_PATHS_OUTPUT}}`;
        let rawAllUrlsCombined = `{{ALL_URLS_COMBINED_OUTPUT}}`;


        function createResultCard(url, statusCode = null, icon = '🔗', priority = 'gray') { 
            const card = document.createElement('div');
            card.className = `result-card ${priority}-priority`;
            card.addEventListener('click', () => copyToClipboard(url));
            
            let statusHtml = '';
            if (statusCode) {
                statusHtml = `<div class="result-status"><span class="status-code">[${statusCode}]</span></div>`;
            }
            
            card.innerHTML = `
                <div class="result-header">
                    <div class="result-icon">${icon}</div>
                    <div class="result-url"><a href="${url}" target="_blank" title="${url}" onclick="event.stopPropagation()">${url}</a></div>
                    ${statusHtml}
                </div>
            `;
            return card;
        }
        
        function renderSimpleList(rawOutput, containerId, icon, priority, filterFn = null) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = '';

            const lines = rawOutput.split('<br>').map(l => l.trim()).filter(l => l);
            if (lines.length === 0 || rawOutput.includes("Brak danych")) {
                container.textContent = "Brak wyników do wyświetlenia.";
                container.style.color = "#888";
                container.style.padding = "10px";
                return;
            }

            lines.forEach(line => {
                const itemUrl = line.split(/\s+/)[0];
                let card = null;
                if (filterFn) {
                    const result = filterFn(itemUrl);
                    if (result.display) {
                        card = createResultCard(itemUrl, null, result.icon, result.priority);
                    }
                } else {
                    card = createResultCard(itemUrl, null, icon, priority);
                }

                if (card) {
                    container.appendChild(card);
                }
            });
        }

        function renderComplexList(rawOutput, containerId, filterFn) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = '';
            
            const lines = rawOutput.split('\n').map(l => l.trim()).filter(l => l);
             if (lines.length === 0 || rawOutput.includes("Brak danych")) {
                container.textContent = "Brak wyników do wyświetlenia.";
                container.style.color = "#888";
                container.style.padding = "10px";
                return;
            }
            
            lines.forEach(line => {
                const result = filterFn(line);
                if (result.display) {
                    const card = createResultCard(result.url, result.code, result.icon, result.priority);
                    container.appendChild(card);
                }
            });
        }
        
        // --- Filtry i Parsery ---
        const sensitiveKeywords = ['admin', 'login', 'panel', 'dashboard', 'config', 'backup', 'db', '.git', '.env', 'secret', 'token', 'jwt', 'credentials', 'password'];
        
        function httpxFilter(line) {
            let parsed = null;
            try { parsed = JSON.parse(line); } catch (e) {}

            let url = null, code = null;
            if (parsed) {
                url = parsed.url || parsed.target || parsed.host;
                code = parsed.status_code || parsed.status || null;
            } else {
                let m = line.match(/(https?:\/\/[^\s\[]+)/i);
                if (m) {
                    url = m[1];
                    const codeMatch = line.match(/\[(\d{3})\]/);
                    if (codeMatch) code = parseInt(codeMatch[1], 10);
                }
            }
            if (!url) return { display: false };
            if (!/^https?:\/\//i.test(url)) url = 'https://' + url;
            
            let priority = 'gray', icon = '🔗', isRed = false;
            if (code) {
                if ([500, 502, 503, 401, 403].includes(code)) { priority = 'red'; icon = '🔥'; isRed = true; }
                else if ([301, 302, 307].includes(code)) { priority = 'orange'; icon = '👉'; }
                else if (code === 200) { priority = 'green'; icon = '✅'; }
                else { priority = 'gray'; icon = '🚫'; }
            }
            if (sensitiveKeywords.some(kw => url.toLowerCase().includes(kw))) { priority = 'red'; icon = '🔥'; isRed = true; }

            return { display: true, url, code, priority, icon, isRed };
        }

        function dirsearchFilter(line) {
            let url = line.split(/\s+/)[0];
            let isRed = sensitiveKeywords.some(kw => url.toLowerCase().includes(kw));
            let priority = isRed ? 'red' : 'gray';
            let icon = isRed ? '🔥' : '📁';
            return { display: true, url, code: null, priority, icon, isRed };
        }
        
        function crawlingFilter(line) {
             let url = line.split(/\s+/)[0];
             let isRed = sensitiveKeywords.some(kw => url.toLowerCase().includes(kw));
             let priority = isRed ? 'red' : 'red';
             let icon = isRed ? '🔥' : '🕸️';
             return { display: true, url, code: null, priority, icon, isRed };
        }

        // --- Funkcje Aplikujące Filtry ---
        function applyHttpxFilter() {
            const showOnlyRed = document.getElementById('showOnlyRedHttpx').checked;
            renderComplexList(rawHttpxOutput, 'httpx-results', (line) => {
                const result = httpxFilter(line);
                if (showOnlyRed && !result.isRed) result.display = false;
                return result;
            });
        }

        function applyVerifiedHttpxFilter() {
            const showOnlyRed = document.getElementById('showOnlyRedVerifiedHttpx').checked;
            renderComplexList(rawHttpxPhase3Verified, 'verified-httpx-results', (line) => {
                const result = httpxFilter(line);
                if (showOnlyRed && !result.isRed) result.display = false;
                return result;
            });
        }

        function applyDirsearchFilter() {
            const showOnlyRed = document.getElementById('showOnlyRedDirsearch').checked;
            renderComplexList(rawDirSearchAll, 'dirsearch-all-results', (line) => {
                 const result = dirsearchFilter(line);
                 if (showOnlyRed && !result.isRed) result.display = false;
                 return result;
            });
        }
        
        function applyCrawlingFilter() {
            const showOnlyRed = document.getElementById('showOnlyRedCrawling').checked;
            renderComplexList(rawPhase4AllUrls, 'crawling-all-results', (line) => {
                 const result = crawlingFilter(line);
                 if (showOnlyRed && !result.isRed) result.display = false;
                 return result;
            });
        }

        // --- Nawigacja Zakładek ---
        function openMainTab(evt, tabName) {
            let i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("main-tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        function openSubTab(evt, mainTabName, subTabName) {
            let i, subtabcontent, subtablinks;
            const mainTab = document.getElementById(mainTabName);
            
            subtabcontent = mainTab.getElementsByClassName("sub-tab-content");
            for (i = 0; i < subtabcontent.length; i++) {
                subtabcontent[i].style.display = "none";
            }
            
            subtablinks = mainTab.getElementsByClassName("sub-tab-button");
            for (i = 0; i < subtablinks.length; i++) {
                subtablinks[i].className = subtablinks[i].className.replace(" active", "");
            }
            
            document.getElementById(mainTabName + "-" + subTabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // --- Inicjalizacja ---
        document.addEventListener('DOMContentLoaded', (event) => {
            // Faza 1
            applyHttpxFilter();
            renderSimpleList(rawSubfinderOutput, 'subfinder-results', '🔍', 'gray');
            renderSimpleList(rawAssetfinderOutput, 'assetfinder-results', '🎯', 'gray');
            renderSimpleList(rawFindomain, 'findomain-results', '🌐', 'gray');
            renderSimpleList(rawPuredns, 'puredns-results', '🔎', 'gray');
            
            // Faza 2
            renderSimpleList(rawNaabuResults, 'naabu-results', '🔌', 'cyan');

            // Faza 3
            applyVerifiedHttpxFilter();
            applyDirsearchFilter();
            renderSimpleList(rawDirsearchSpecific, 'dirsearch-results-specific', '🔍', 'green');
            renderSimpleList(rawFfufSpecific, 'ffuf-results-specific', '💥', 'orange');
            renderSimpleList(rawFeroxbusterSpecific, 'feroxbuster-results-specific', '👹', 'red');
            renderSimpleList(rawGobusterSpecific, 'gobuster-results-specific', '🏃‍♂️', 'yellow');

            // Faza 4
            applyCrawlingFilter();
            renderSimpleList(rawParameters, 'parameters-results', '🔧', 'yellow');
            renderSimpleList(rawJSFiles, 'js-files-results', '📄', 'green');
            renderSimpleList(rawAPIEndpoints, 'api-endpoints-results', '🔌', 'orange');
            renderSimpleList(rawInterestingPaths, 'interesting-paths-results', '📁', 'cyan');

            // Zakładka 'Wszystkie Wyniki'
            renderSimpleList(rawAllSubdomains, 'all-subdomains-results', '🌍', 'gray');
            renderSimpleList(rawAllUrlsCombined, 'all-urls-combined-results', '🔗', 'gray');
            
            // Aktywuj pierwszą główną i podrzędną zakładkę
            document.querySelector('.main-tab-button').click();
            const firstSubTab = document.querySelector('.sub-tab-button');
            if(firstSubTab) {
                firstSubTab.click();
            }
        });
    </script>
</body>
</html>